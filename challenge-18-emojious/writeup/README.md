# Emojious - Write-Up

| Δοκιμασία | Emojious |
| :-------- | :----------------- |
| Δυσκολία  | Εύκολη             |
| Κατηγορία | Αντίστροφη μηχανική  (Reverse Engineering)  		 |
| Λύσεις    | 33                  |
| Πόντοι    | 100                  |

# Περιγραφή Δοκιμασίας

I am pretty sure you are using emojis everyday..

# Ανάλυση Κώδικα

Το πρόγραμμα δέχεται ένα string ως είσοδο (magic key) και στη συνέχεια αποκρυπτογραφεί ένα κρυφό μήνυμα χρησιμοποιώντας XOR.

```python
def main():
    cp = '🙧😏🙮🙸🙌🙄😮🙀🙕🙞🙒😜🙎🙍🙒🙾😱🙊🙞🙛🙍😺🙰🙌🙇🙄😠🙆🙞🙛🙾😷🙇🙚🙄🙄😜🙋🙞🙎🙒😾'
    print(f"This is interesting: {cp}")
    mkey = input("Type the magic key: ")
    
    # XOR αποκρυπτογράφηση
    pt = ''.join([chr(ord(c) ^ ord(mkey[i % len(mkey)])) for i, c in enumerate(cp)])
    
    print(f"And this is what you've got: {pt}")
```

# Πώς λειτουργεί η κρυπτογράφηση;

- Υπάρχει ένα κρυφό μήνυμα cp, το οποίο είναι κωδικοποιημένο με XOR και αποτελείται από emojis.
- Το πρόγραμμα ζητά από τον χρήστη να εισάγει το "magic key".
- Στη συνέχεια, αποκρυπτογραφεί το μήνυμα με βάση αυτό το magic key.
- Το μήνυμα αποκρυπτογραφείται κάνοντας XOR χαρακτήρα προς χαρακτήρα με το κλειδί:

```python
pt = ''.join([chr(ord(c) ^ ord(mkey[i % len(mkey)])) for i, c in enumerate(cp)])
```

Κάθε χαρακτήρας του cp γίνεται XOR με τον αντίστοιχο χαρακτήρα του mkey (που επαναλαμβάνεται κυκλικά αν είναι μικρότερο από cp).

### Σημαντική παρατήρηση

Η υπόδειξη λέει ότι το flag έχει τη μορφή FLAG{....}, οπότε η είσοδος (magic key) είναι το ίδιο το flag.

# Εκμετάλλευση της Ευπάθειας

Εφόσον γνωρίζουμε ότι το flag είναι το key, μπορούμε να χρησιμοποιήσουμε αυτήν τη γνώση για να ανακτήσουμε την πλήρη σημαία βήμα προς βήμα.

Το exploit που γράψαμε λειτουργεί ως εξής:

```python
cp = '🙧😏🙮🙸🙌🙄😮🙀🙕🙞🙒😜🙎🙍🙒🙾😱🙊🙞🙛🙍😺🙰🙌🙇🙄😠🙆🙞🙛🙾😷🙇🙚🙄🙄😜🙋🙞🙎🙒😾'
flag = "FLAG{"  # Ξέρουμε ότι το flag ξεκινάει έτσι

# Υπολογίζουμε το key για τα πρώτα 5 bytes του flag
key = ''.join([chr(ord(cp[j]) ^ ord(flag[j % len(flag)])) for j in range(len(flag))])

# Χρησιμοποιούμε το key για να αποκρυπτογραφήσουμε το υπόλοιπο μήνυμα
plaintext = ''.join([chr(ord(c) ^ ord(key[j % len(flag)])) for j, c in enumerate(cp)])

print("Key: ", key)
print("Flag: ", plaintext)
```
## Ανάλυση της εκμετάλλευσης

1. Υπολογίζουμε το κλειδί (key)

- Εφόσον ξέρουμε ότι το flag ξεκινά με "FLAG{", μπορούμε να υπολογίσουμε τα πρώτα 5 bytes του key κάνοντας XOR μεταξύ των αντίστοιχων χαρακτήρων του cp και του "FLAG{".

2. Χρησιμοποιούμε το key για να αποκρυπτογραφήσουμε το πλήρες flag

- Ξέρουμε ότι το key είναι κυκλικό, οπότε μπορούμε να το επαναλαμβάνουμε για όλο το cp και να κάνουμε XOR decoding.

## Εκτέλεση του Exploit

Μετά την εκτέλεση του script μας, λαμβάνουμε:

```python
Key:  😡🙃😯😿😷
Flag:  FLAG{emojis_are_really_special_these_days}
```
